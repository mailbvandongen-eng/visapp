import{C as z,g as F,f as H,c as b,i as q,I as u,d as Y,e as $,h as f,j as L,k as J,l as N,m as V,L as Z,n as B,o as W,p as Q,q as ee,r as te,s as se,E as U,u as ie,t as ne,v as re,w as ae,x as G,y as oe,z as w,A as ce,B as he,D as ge,G as X,H as C,J as le}from"./index-BqKu6X7m.js";import{D as _}from"./common-DpNHzTjJ.js";class ue extends z{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const i=e.layerStatesArray[e.layerIndex],t=e.pixelRatio,n=e.viewState,s=n.resolution,r=this.getLayer().getSource(),o=e.viewHints;let a=e.extent;if(i.extent!==void 0&&(a=F(a,H(i.extent,n.projection))),!o[b.ANIMATING]&&!o[b.INTERACTING]&&!q(a))if(r){const h=n.projection,g=r.getImage(a,s,t,h);g&&(this.loadImage(g)?this.image=g:g.getState()===u.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const i=this.frameState;if(!i)return null;const t=this.getLayer(),n=Y(i.pixelToCoordinateTransform,e.slice()),s=t.getExtent();if(s&&!$(s,n))return null;const r=this.image.getExtent(),o=this.image.getImage(),a=f(r),h=Math.floor(o.width*((n[0]-r[0])/a));if(h<0||h>=o.width)return null;const g=L(r),l=Math.floor(o.height*((r[3]-n[1])/g));return l<0||l>=o.height?null:this.getImageData(o,h,l)}renderFrame(e,i){const t=this.image,n=t.getExtent(),s=t.getResolution(),[r,o]=Array.isArray(s)?s:[s,s],a=t.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],g=e.pixelRatio,l=e.viewState,m=l.center,p=l.resolution,x=g*r/(p*a),y=g*o/(p*a);this.prepareContainer(e,i);const I=this.context.canvas.width,S=this.context.canvas.height,d=this.getRenderContext(e);let v=!1,O=!0;if(h.extent){const R=H(h.extent,l.projection);O=J(R,e.extent),v=O&&!N(R,e.extent),v&&this.clipUnrotated(d,e,R)}const E=t.getImage(),A=V(this.tempTransform,I/2,S/2,x,y,0,a*(n[0]-m[0])/r,a*(m[1]-n[3])/o);this.renderedResolution=o*g/a;const M=E.width*A[0],T=E.height*A[3];if(this.getLayer().getSource().getInterpolate()||(d.imageSmoothingEnabled=!1),this.preRender(d,e),O&&M>=.5&&T>=.5){const R=A[4],K=A[5],D=h.opacity;D!==1&&(d.save(),d.globalAlpha=D),d.drawImage(E,0,0,+E.width,+E.height,R,K,M,T),D!==1&&d.restore()}return this.postRender(this.context,e),v&&d.restore(),d.imageSmoothingEnabled=!0,this.container}}class de extends Z{constructor(e){e=e||{},super(e)}}class me extends de{constructor(e){super(e)}createRenderer(){return new ue(this)}getData(e){return super.getData(e)}}function P(c){return Array.isArray(c)?Math.min(...c):c}class Ie extends B{constructor(e,i,t,n,s,r,o){let a=e.getExtent();a&&e.canWrapX()&&(a=a.slice(),a[0]=-1/0,a[2]=1/0);let h=i.getExtent();h&&i.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const g=h?F(t,h):t,l=W(g),m=Q(e,i,l,n),p=ne,x=new ee(e,i,g,a,m*p,n),y=x.calculateSourceExtent(),I=q(y)?null:r(y,m,s),S=I?u.IDLE:u.EMPTY,d=I?I.getPixelRatio():1;super(t,n,d,S),this.targetProj_=i,this.maxSourceExtent_=a,this.triangulation_=x,this.targetResolution_=n,this.targetExtent_=t,this.sourceImage_=I,this.sourcePixelRatio_=d,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const i=f(this.targetExtent_)/this.targetResolution_,t=L(this.targetExtent_)/this.targetResolution_;this.canvas_=te(i,t,this.sourcePixelRatio_,P(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=se(this.sourceImage_,U.CHANGE,i=>{const t=this.sourceImage_.getState();(t==u.LOADED||t==u.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){ie(this.sourceListenerKey_),this.sourceListenerKey_=null}}const j={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class _e extends he{constructor(e,i){super(e),this.image=i}}class Ee extends re{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const i=this.getResolutions();if(i){const t=ae(i,e,0);e=i[t]}return e}getImage(e,i,t,n){const s=this.getProjection();if(!s||!n||G(s,n))return s&&(n=s),this.getImageInternal(e,i,t,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&G(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==i&&oe(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ie(s,n,e,i,t,(r,o,a)=>this.getImageInternal(r,o,a,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,i,t,n){if(this.loader){const s=k(e,i,t,1),r=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&N(this.wantedExtent_,s)||N(this.image.getExtent(),s))&&(this.wantedResolution_&&P(this.wantedResolution_)===r||P(this.image.getResolution())===r)))return this.image;this.wantedProjection_=n,this.wantedExtent_=s,this.wantedResolution_=r,this.image=new B(s,r,t,this.loader),this.image.addEventListener(U.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const i=e.target;let t;switch(i.getState()){case u.LOADING:this.loading=!0,t=j.IMAGELOADSTART;break;case u.LOADED:this.loading=!1,t=j.IMAGELOADEND;break;case u.ERROR:this.loading=!1,t=j.IMAGELOADERROR;break;default:return}this.hasListener(t)&&this.dispatchEvent(new _e(t,i))}}function Re(c,e){c.getImage().src=e}function k(c,e,i,t){const n=e/i,s=W(c),r=w(f(c)/n,_),o=w(L(c)/n,_),a=w((t-1)*r/2,_),h=r+2*a,g=w((t-1)*o/2,_),l=o+2*g;return ce(s,n,0,[h,l])}function fe(c,e,i,t,n,s){const r=n.getCode().split(/:(?=\d+$)/).pop(),o=i/t,a=[C(f(e)/o,_),C(L(e)/o,_)];s.SIZE=a[0]+","+a[1],s.BBOX=e.join(","),s.BBOXSR=r,s.IMAGESR=r,s.DPI=Math.round(s.DPI?s.DPI*t:90*t);const h=c.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return le(h,s)}function pe(c){const e=c.load?c.load:X,i=ge(c.projection||"EPSG:3857"),t=c.ratio??1.5,n=c.crossOrigin??null;return function(s,r,o){o=c.hidpi?o:1;const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(a,c.params),s=k(s,r,o,t);const h=fe(c.url,s,r,o,i,a),g=new Image;return g.crossOrigin=n,e(g,h).then(l=>{const m=f(s)/l.width*o;return{image:l,extent:s,resolution:m,pixelRatio:o}})}}class xe extends Ee{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Re,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,i,t,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=pe({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,r)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,r),X(s))})),super.getImageInternal(e,i,t,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}function we(){return new me({properties:{title:"AHN4 Hillshade",type:"arcgis"},visible:!1,opacity:.5,source:new xe({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Hillshade (Multidirectionaal)"})},crossOrigin:"anonymous",attributions:"Â© Esri Nederland, AHN4"})})}export{we as createAHN4MultiHillshadeLayer};
//# sourceMappingURL=hillshadeLayers-C0wq_5B1.js.map
